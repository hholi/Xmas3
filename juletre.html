<!DOCTYPE HTML>
<html lang="en"> 
<meta charset="utf-8"> 
	<head>
	<title>Juletre</title>
	<style type="text/css"> 
		body { 
			background-color:black; 
			margin:0px; 
			overflow : hidden; 
		}
		</style> 
	</head>
	
	<body>
	
		<script>

var canvas = document.createElement('canvas'); 
document.body.appendChild(canvas); 
canvas.width = window.innerWidth; 
canvas.height = window.innerHeight; 

var ctx = canvas.getContext('2d'); 
var generation = 0; 
var firstBranch = true;

var tree = new Branch(150, 0, true); 

draw(); 

function draw() { 
	ctx.save(); 
	ctx.clearRect(0,0,canvas.width, canvas.height); 
	ctx.translate(canvas.width/2, canvas.height-100); 
	tree.render(); 
	ctx.restore(); 

	window.requestAnimationFrame(draw); 
}

function Star(size) { 
	this.render = function() { 
		ctx.beginPath(); 
		ctx.strokeStyle = 'yellow'; 
		ctx.arc(0, 0, 10, 0, 2*Math.PI);
		ctx.fill();  
		ctx.stroke();
		ctx.closePath(); 			
	}
}

function Branch(size, rotation, main) { 
	generation++; 
	var sway = 0; 
	var swaySpeed = random(0.02,0.1); 
	var growth = 0; 
	var delay = generation*10; 
	
	this.children = [];
	if(main) {
		firstBranch = false;
		if(size>10) {
			this.children.push(new Branch(size*random(0.5,0.6), random(60,70), false)); 
			this.children.push(new Branch(size*random(0.5,0.6), random(-60,-70), false)); 
			this.children.push(new Branch(size*random(0.7,0.9), random(-5,5), main)); 
		} else {
			// the top
			this.children.push(new Star(10)); 
		}
	} else {
		if(size>10) {
			this.children.push(new Branch(size*random(0.4,0.7), random(60,70), false)); 
			this.children.push(new Branch(size*random(0.4,0.7), random(-60,-70), false)); 
			this.children.push(new Branch(size*random(0.65,0.8), random(-5,5), main)); 
		}
	}

	
	this.render = function() { 

		ctx.save(); 
		ctx.rotate((rotation+Math.sin(sway)) * Math.PI/180); 
		ctx.strokeStyle = 'green'; 
		ctx.beginPath(); 
		ctx.lineWidth = size*0.1*growth;
		ctx.moveTo(0,0); 
		ctx.lineTo(0,-size*growth);
		ctx.stroke();
		if(size < 8) { // only ligths in small branches
			if (random(1,10) < 9) { // blinking
				ctx.beginPath(); 
				ctx.strokeStyle = 'yellow'; 
				ctx.arc(0, -size*growth, 2, 0, 2*Math.PI);
				ctx.stroke(); 
				ctx.closePath(); 
			}
		}
		ctx.translate(0,-size*growth); 
		ctx.strokeStyle = 'green'; 
		
		for(var i = 0; i<this.children.length; i++) { 
			this.children[i].render(); 
		}

		ctx.restore(); 
		sway+=swaySpeed;
		if(delay>0) { 
			delay--; 
		} else { 
			growth+=(1-growth) * 0.1; 
		}
	}
	generation--; 
	
}

function random(min, max) { 
	return Math.random()*(max-min) +min; 
	
}


		</script>			
	</body>
	
	
</html>


