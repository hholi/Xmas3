<!DOCTYPE HTML>
<html lang="en"> 
<meta charset="utf-8"> 
	<head>
		<title>Christmas tree</title>
		<style type="text/css"> 
			body { 
				background-color:black; 
				margin:0px; 
				overflow : hidden; 
			}
		</style> 
	</head>
	<body>
		<script>

// Based on swaying tree by Seb Lee-Delisle
// https://github.com/sebleedelisle/live-coding-presentations

var canvas = document.createElement('canvas'); 
document.body.appendChild(canvas); 
canvas.width = window.innerWidth; 
canvas.height = window.innerHeight; 

var ctx = canvas.getContext('2d'); 
var xmas = false
var tree = new Branch(100, 0, true, 0); 

draw(); 

function draw() { 
	ctx.save(); 
	ctx.clearRect(0,0,canvas.width, canvas.height); 
	ctx.translate(canvas.width*0.3, canvas.height-100); 
	tree.render(); 
	ctx.restore(); 

	window.requestAnimationFrame(draw); 
}

function drawStar(cx,cy,spikes,outerRadius,innerRadius){
	var rot=Math.PI/2*3;
	var x=cx;
	var y=cy;
	var step=Math.PI/spikes;

	ctx.beginPath();
	ctx.moveTo(cx,cy-outerRadius)
	for(i=0;i<spikes;i++){
		x=cx+Math.cos(rot)*outerRadius;
		y=cy+Math.sin(rot)*outerRadius;
		ctx.lineTo(x,y);
		rot+=step;

		x=cx+Math.cos(rot)*innerRadius;
		y=cy+Math.sin(rot)*innerRadius;
		ctx.lineTo(x,y);
		rot+=step;
	}
	ctx.lineTo(cx,cy-outerRadius);
	ctx.closePath();
	ctx.lineWidth=2;
	ctx.strokeStyle='gold';
	ctx.stroke();
	ctx.fillStyle='yellow';
	ctx.fill();
}

function Star(size, top) { 
	this.render = function() { 
		if (xmas) {
			ctx.beginPath(); 
			ctx.strokeStyle = 'orange'; 
			ctx.fillStyle = 'yellow'; 
			if (top) {
				drawStar(0,0,5,size*1.5,size/2);
			} else {
				if (random(1,20) < 19) { // twinkle			
					ctx.arc(0, 0, size, 0, 2*Math.PI);
				}
			}
			ctx.fill();  
			ctx.stroke();
			ctx.closePath(); 			
		}
	}
}

function Branch(size, rotation, stem, generation) { 
	generation = generation + 1; 
	var sway = 0; 
	var swaySpeed = random(0.005,0.02); 
	var growth = 0; 
	var delay = generation*10; 
	
	this.children = [];

	if(size>10) {
		if (stem) {
			// stem continues
			this.children.push(new Branch(size*random(0.85,0.9), random(-2,2), stem, generation)); 

			//branches in front and back
			this.children.push(new Branch(size*random(0.4,0.5), random(-30,30), false, generation)); 
			this.children.push(new Branch(size*random(0.2,0.3), random(110,250), false, generation)); 
		} else {
			// branch continues after junction
			this.children.push(new Branch(size*random(0.70,0.85), random(-10,10), stem, generation)); 
		}

		//branches to the sides
		this.children.push(new Branch(size*random(0.63,0.68), random(55,70), false, generation)); 
		this.children.push(new Branch(size*random(0.63,0.68), random(-55,-70), false, generation)); 


	} else {
		// Lights in the ends
		if(stem) {
			// Star in the top
			this.children.push(new Star(size*1.5, true)); 
		} else {
			// small lights
			if (random(1,20) < 2) { // only somewhere
				this.children.push(new Star(2, false)); 
			}
		}
	}

	
	this.render = function() { 

		ctx.save(); 
		ctx.rotate((rotation+Math.sin(sway)) * Math.PI/180); 
		ctx.beginPath(); 
		ctx.lineWidth = size*0.13*growth;
		if (ctx.lineWidth > 5) {
			ctx.strokeStyle = 'Sienna'; 
		} else {
			ctx.strokeStyle = 'OliveDrab'; 
		}
		ctx.moveTo(0,0); 
		ctx.lineTo(0,-size*growth);
		ctx.stroke();

		ctx.translate(0,-size*growth); 
		
		for(var i = 0; i<this.children.length; i++) { 
			this.children[i].render(); 
		}

		ctx.restore(); 
		sway+=swaySpeed;
		if(delay>0) { 
			delay--; 
		} else { 
			growth+=(1-growth) * 0.1; 
		}

		// Is it Christmas??
		if (growth > 0.99999) {
			xmas = true
		}

	}

}

function random(min, max) { 
	return Math.random()*(max-min) +min; 
	
}

		</script>			
	</body>	
</html>