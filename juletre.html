<!DOCTYPE HTML>
<html lang="en"> 
<meta charset="utf-8"> 
	<head>
	<title>Juletre</title>
	<style type="text/css"> 
		body { 
			background-color:black; 
			margin:0px; 
			overflow : hidden; 
		}
		</style> 
	</head>
	
	<body>
	
		<script>

var canvas = document.createElement('canvas'); 
document.body.appendChild(canvas); 
canvas.width = window.innerWidth; 
canvas.height = window.innerHeight; 

var ctx = canvas.getContext('2d'); 
var generation = 0; 
var firstBranch = true;

var tree = new Branch(150, 0, true); 

draw(); 

function draw() { 
	ctx.save(); 
	ctx.clearRect(0,0,canvas.width, canvas.height); 
	ctx.translate(canvas.width/2, canvas.height-100); 
	tree.render(); 
	ctx.restore(); 

	window.requestAnimationFrame(draw); 
}

function drawStar(cx,cy,spikes,outerRadius,innerRadius){
      var rot=Math.PI/2*3;
      var x=cx;
      var y=cy;
      var step=Math.PI/spikes;

      ctx.beginPath();
      ctx.moveTo(cx,cy-outerRadius)
      for(i=0;i<spikes;i++){
        x=cx+Math.cos(rot)*outerRadius;
        y=cy+Math.sin(rot)*outerRadius;
        ctx.lineTo(x,y)
        rot+=step

        x=cx+Math.cos(rot)*innerRadius;
        y=cy+Math.sin(rot)*innerRadius;
        ctx.lineTo(x,y)
        rot+=step
      }
      ctx.lineTo(cx,cy-outerRadius);
      ctx.closePath();
      ctx.lineWidth=5;
      ctx.strokeStyle='gold';
      ctx.stroke();
      ctx.fillStyle='yellow';
      ctx.fill();
    }

function Star(size, top) { 
	this.render = function() { 
		ctx.beginPath(); 
		ctx.strokeStyle = 'orange'; 
		ctx.fillStyle = 'yellow'; 
		if (top) {
			drawStar(0,0,5,size*1.5,size/2);
		} else {
			if (random(1,20) < 19) { // blinking			
				ctx.arc(0, 0, size, 0, 2*Math.PI);
			}
		}
		ctx.fill();  
		ctx.stroke();
		ctx.closePath(); 			
	}
}

function Branch(size, rotation, main) { 
	generation++; 
	var sway = 0; 
	var swaySpeed = random(0.01,0.04); 
	var growth = 0; 
	var delay = generation*10; 
	
	this.children = [];
	if(main) {
		firstBranch = false;
		if(size>10) {
			// stem continues
			this.children.push(new Branch(size*random(0.8,0.9), random(-3,3), main)); 

			//branches to the sides
			this.children.push(new Branch(size*random(0.5,0.6), random(60,70), false)); 
			this.children.push(new Branch(size*random(0.5,0.6), random(-60,-70), false)); 

			//branches in front and back
			this.children.push(new Branch(size*random(0.4,0.5), random(-20,30), false)); 
			this.children.push(new Branch(size*random(0.4,0.5), random(-30,20), false)); 

		} else {
			// the top
			this.children.push(new Star(size*1.5, true)); 
		}
	} else {
		if(size>10) {
			this.children.push(new Branch(size*random(0.4,0.6), random(60,70), false)); 
			this.children.push(new Branch(size*random(0.4,0.6), random(-60,-70), false)); 
			this.children.push(new Branch(size*random(0.65,0.8), random(-3,3), main)); 

			//branches in front and back
			this.children.push(new Branch(size*random(0.3,0.4), random(-20,30), false)); 
			this.children.push(new Branch(size*random(0.3,0.4), random(-30,20), false)); 
			
		} else {
			// light
			if (random(1,20) < 4) { // only somewhere
				this.children.push(new Star(2, false)); 
			}
		}
	}

	
	this.render = function() { 

		ctx.save(); 
		ctx.rotate((rotation+Math.sin(sway)) * Math.PI/180); 
		ctx.strokeStyle = 'ForestGreen'; 
		ctx.beginPath(); 
		ctx.lineWidth = size*0.1*growth;
		ctx.moveTo(0,0); 
		ctx.lineTo(0,-size*growth);
		ctx.stroke();
		// if(size < 8) { // only ligths in small branches
		// 	if (random(1,10) < 9) { // blinking
		// 		ctx.beginPath(); 
		// 		ctx.strokeStyle = 'yellow'; 
		// 		ctx.arc(0, -size*growth, 2, 0, 2*Math.PI);
		// 		ctx.stroke(); 
		// 		ctx.closePath(); 
		// 	}
		// }
		ctx.translate(0,-size*growth); 
		ctx.strokeStyle = 'ForestGreen'; 
		
		for(var i = 0; i<this.children.length; i++) { 
			this.children[i].render(); 
		}

		ctx.restore(); 
		sway+=swaySpeed;
		if(delay>0) { 
			delay--; 
		} else { 
			growth+=(1-growth) * 0.1; 
		}
	}
	generation--; 
	
}

function random(min, max) { 
	return Math.random()*(max-min) +min; 
	
}


		</script>			
	</body>
	
	
</html>


